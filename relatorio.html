<!-- relatorio.html -->
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Relat√≥rio Mensal - Controle Financeiro</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <nav>
      <h1>Controle Financeiro</h1>
      <ul>
        <li><a href="home.html">In√≠cio</a></li>
        <li><a href="relatorio.html" class="active">Relat√≥rio Mensal</a></li>
        <li><a href="historico.html">Hist√≥rico</a></li>
        <li><a href="configuracoes.html">Configura√ß√µes</a></li>
        <li><button id="btnLogout">Sair</button></li>
      </ul>
    </nav>

    <main class="container">
      <div class="report-header">
        <h2>Relat√≥rio Mensal</h2>
        <select id="selectAno" class="year-select">
          <!-- Anos ser√£o adicionados dinamicamente -->
        </select>
      </div>

      <div class="report-filters">
        <div class="months">
          <button class="month-btn" data-mes="1">Janeiro</button>
          <button class="month-btn" data-mes="2">Fevereiro</button>
          <button class="month-btn" data-mes="3">Mar√ßo</button>
          <button class="month-btn" data-mes="4">Abril</button>
          <button class="month-btn" data-mes="5">Maio</button>
          <button class="month-btn" data-mes="6">Junho</button>
          <button class="month-btn" data-mes="7">Julho</button>
          <button class="month-btn" data-mes="8">Agosto</button>
          <button class="month-btn" data-mes="9">Setembro</button>
          <button class="month-btn" data-mes="10">Outubro</button>
          <button class="month-btn" data-mes="11">Novembro</button>
          <button class="month-btn" data-mes="12">Dezembro</button>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Entrada</th>
            <th>Sa√≠da</th>
            <th>Despesa Di√°ria</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody id="relatorioTableBody">
          <!-- Linhas ser√£o adicionadas dinamicamente -->
        </tbody>
        <tfoot>
          <tr>
            <td><strong>Total</strong></td>
            <td id="totalEntrada">R$ 0,00</td>
            <td id="totalSaida">R$ 0,00</td>
            <td id="totalDespesaDiaria">R$ 0,00</td>
            <td></td>  <!-- C√©lula vazia para manter o alinhamento -->
          </tr>
        </tfoot>
      </table>
    </main>

    <button id="themeToggle" class="theme-toggle" aria-label="Alternar tema">
      üåì
    </button>

    <script type="module">
      import { checkAuth, logout } from "./auth.js";
      import { initializeReport, verificarStatusMeses } from "./finance.js";

      let cleanup = null;

      async function init() {
        try {
          await checkAuth();
          
          // Seleciona e marca o m√™s atual
          const monthButtons = document.querySelectorAll('.month-btn');
          const mesAtual = new Date().getMonth() + 1;
          monthButtons.forEach(btn => {
            if (parseInt(btn.dataset.mes) === mesAtual) {
              btn.classList.add('selected');
            }
          });

          const anoAtual = new Date().getFullYear();
          // Atualiza as cores dos bot√µes conforme o saldo di√°rio
          await verificarStatusMeses(anoAtual);

          // Inicia o relat√≥rio e guarda a fun√ß√£o de limpeza
          cleanup = initializeReport();

        } catch (error) {
          console.error('Erro na inicializa√ß√£o:', error);
          window.location.href = 'index.html';
        }
      }

      // Inicializa quando o DOM estiver pronto
      document.addEventListener('DOMContentLoaded', init);

      // Setup dos event listeners
      document.getElementById("btnLogout").onclick = logout;

      // Limpa as inscri√ß√µes quando sair da p√°gina
      window.addEventListener('unload', () => {
        if (cleanup) cleanup();
      });
    </script>

    <!-- Substitua o script antigo do tema por esta linha em todos os arquivos HTML -->
    <script src="theme.js"></script>

    <!-- Remover este bloco de todas as p√°ginas -->
    <script type="text/html" id="footer-template">
        <!-- Conte√∫do do footer.html aqui -->
    </script>

    <script>
      // Carrega o rodap√© dinamicamente
      fetch('footer.html')
        .then(response => response.text())
        .then(html => {
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = html;
          document.body.appendChild(tempDiv.firstElementChild);
        })
        .then(() => {
          // Atualiza os valores do rodap√© ap√≥s ele ser carregado
          if (typeof atualizarRodape === 'function') {
            atualizarRodape();
          }
        });
    </script>
  </body>
</html>
